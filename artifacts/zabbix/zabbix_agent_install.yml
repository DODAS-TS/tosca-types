- tasks:
  - name: Download Zabbix release deb file
    get_url: 
      url="http://repo.zabbix.com/zabbix/2.4/debian/pool/main/z/zabbix-release/zabbix-release_2.4-1+jessie_all.deb"
      dest="/tmp/zabbix-release_2.4-1+jessie_all.deb"
    when: ansible_os_family == "Debian"

  - name: Apt install Zabbix release  in Ubuntu
    apt: deb="/tmp/zabbix-release_2.4-1+jessie_all.deb"
    when: ansible_os_family == "Debian"

  - name: Yum install Zabbix release in RHEL or CentOS
    yum: name=http://repo.zabbix.com/zabbix/2.4/rhel/{{ ansible_distribution_version.split('.')[0] }}/x86_64/zabbix-release-2.4-1.el{{ ansible_distribution_version.split('.')[0] }}.noarch.rpm
    when: ansible_os_family == "RedHat"

  - name: Apt install Zabbix agent
    apt: name=zabbix-agent
    when: ansible_os_family == "Debian"

  - name: Yum install Zabbix agent
    yum: name=zabbix-agent
    when: ansible_os_family == "RedHat"